<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ä°lahi ve Åiir TercÃ¼manÄ±</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css">
    <style>
        /* =========================================
           GENEL TASARIM
        ========================================= */
        body { 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 15px; /* Mobilde kenar boÅŸluÄŸunu azalttÄ±k */
            text-align: center; 
            background-color: #e8f5e9; 
            font-family: 'Segoe UI', 'Georgia', serif; 
            color: #1b5e20; 
        }

        .container { 
            background: #ffffff; 
            padding: 30px 20px; 
            border-radius: 15px; 
            box-shadow: 0 10px 25px rgba(27, 94, 32, 0.15); 
            border: 1px solid #c8e6c9; 
        }

        h1 { color: #2e7d32; font-family: 'Georgia', serif; letter-spacing: 1px; margin-bottom: 20px; font-size: 1.8rem; }
        .hidden { display: none !important; }

        /* =========================================
           FOTOÄRAF KUTUSU
        ========================================= */
        .box { 
            border: 2px dashed #66bb6a; 
            padding: 20px; 
            border-radius: 10px; 
            margin: 20px 0; 
            background: #f1f8e9; 
            cursor: pointer;
        }
        #preview { max-width: 100%; border-radius: 8px; margin-top: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }

        /* =========================================
           BUTONLAR
        ========================================= */
        .btn-primary { 
            background-color: #2e7d32; 
            color: white !important; 
            width: 100%; 
            padding: 15px; 
            font-size: 1.1rem; 
            margin-top: 15px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: bold; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .btn-primary:disabled { background-color: #a5d6a7; cursor: not-allowed; }

        /* =========================================
           Ã‡IKTI KUTUSU - MOBÄ°L SORUNU Ã‡Ã–ZÃœMÃœ (V8)
        ========================================= */
        #output { 
            text-align: left; 
            background: #f9fbe7; 
            color: #004d40; 
            padding: 20px; 
            border-radius: 10px; 
            margin-top: 25px; 
            font-family: 'Georgia', serif; 
            font-size: 1.1em; 
            border-left: 5px solid #2e7d32; 
            box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
            
            /* MOBÄ°L ÃœST ÃœSTE BÄ°NME SORUNU Ä°Ã‡Ä°N KRÄ°TÄ°K KODLAR: */
            white-space: pre-wrap;       /* SatÄ±r sonlarÄ±nÄ± korur ama uzun satÄ±rlarÄ± bÃ¶ler */
            word-wrap: break-word;       /* Uzun kelimeleri kÄ±rar */
            overflow-wrap: break-word;   /* Modern tarayÄ±cÄ±lar iÃ§in kÄ±rma */
            word-break: break-word;      /* GÃ¼venlik Ã¶nlemi */
            line-height: 1.8;            /* SatÄ±r arasÄ±nÄ± aÃ§tÄ±k ki harfler Ã§akÄ±ÅŸmasÄ±n */
        }

        /* BaÅŸlÄ±klar */
        #output h3 {
            color: #2e7d32 !important;
            margin-top: 30px;
            margin-bottom: 15px;
            font-weight: bold;
            border-bottom: 1px solid #c8e6c9;
            padding-bottom: 5px;
        }

        /* =========================================
           YENÄ° Ã–ZELLÄ°K: RENKLÄ° KELÄ°ME VURGUSU
        ========================================= */
        /* Yapay zeka deÄŸiÅŸtirilen kelimeyi **kalÄ±n** yapacak, biz de onu boyayacaÄŸÄ±z */
        #output strong {
            color: #d84315; /* Kiremit Rengi / Koyu Turuncu */
            font-weight: 700;
            text-decoration: underline; /* AltÄ±nÄ± Ã§izelim ki belli olsun */
            text-decoration-color: #ffccbc;
            text-decoration-style: dotted; /* NoktalÄ± alt Ã§izgi */
        }

        /* Tablo DÃ¼zeni */
        #output table { width: 100%; border-collapse: collapse; margin-top: 10px; table-layout: fixed; }
        #output table tr { border-bottom: 1px solid #dcedc8; }
        #output table td, #output table th { 
            background-color: transparent !important; 
            padding: 8px 5px; 
            vertical-align: top;
            word-wrap: break-word; /* Tablo iÃ§inde de taÅŸmayÄ± engelle */
        }
        #output table td:first-child { 
            font-weight: bold; color: #1b5e20 !important; width: 40%; 
        }

        /* Sabit Metinler */
        .dervis-sozu { font-style: italic; color: #2e7d32; font-weight: bold; margin-bottom: 15px; display: block; border-bottom: 1px solid #c8e6c9; padding-bottom: 10px; }
        .dervis-bitis { font-style: italic; color: #2e7d32; font-weight: bold; margin-top: 20px; display: block; border-top: 1px solid #c8e6c9; padding-top: 10px; text-align: right; }
        
        /* GiriÅŸ EkranÄ± */
        #loginSection { padding: 20px; display: flex; flex-direction: column; align-items: center; }
        #passwordInput { width: 100%; max-width: 250px; padding: 12px; text-align: center; border: 2px solid #a5d6a7; border-radius: 8px; margin-bottom: 15px; background: #fff; color: #1b5e20; display: block; }
        .loading-spinner { font-size: 1.1rem; color: #2e7d32; font-style: italic; margin-top: 20px; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸƒ Ä°lahi ve Åiir TercÃ¼manÄ±</h1>

    <div id="loginSection">
        <p style="font-weight: bold; color: #388e3c; margin-bottom: 15px;">LÃ¼tfen parola giriniz:</p>
        <input type="password" id="passwordInput" placeholder="......" onkeyup="enterBasincaGiris(event)">
        <button onclick="sifreKontrol()" class="btn-primary" style="max-width: 250px;">GiriÅŸ Yap</button>
        <p id="errorMsg" style="color: #c62828; display: none; margin-top: 10px;">ğŸ›‘ HatalÄ± parola!</p>
    </div>

    <div id="appSection" class="hidden">
        <p style="font-style: italic; color: #558b2f; margin-bottom: 20px; font-size: 0.95em;">
            "Destur Efendim, OsmanlÄ±ca veya Eski Dilli Ä°lahilerin gÃ¼nÃ¼mÃ¼z TÃ¼rkÃ§esine Ã§evrilmesi iÃ§in fotoÄŸraf Ã§ekin ya da yÃ¼kleyin."
        </p>

        <div class="box">
            <label for="fileInput" style="display: block;">
                ğŸ“· <span style="font-weight: bold; text-decoration: underline;">FotoÄŸraf SeÃ§mek Ä°Ã§in TÄ±klayÄ±n</span>
            </label>
            <input type="file" id="fileInput" accept="image/*" capture="environment" style="display: none;">
            <img id="preview" class="hidden">
        </div>
        
        <button onclick="cevir()" class="btn-primary" id="translateBtn">âœ¨ TercÃ¼meyi BaÅŸlat</button>
        
        <div id="status" class="hidden loading-spinner">
            â³ Metin inceleniyor...<br>Kelimeler gÃ¼nÃ¼mÃ¼ze uyarlanÄ±yor...
        </div>

        <div id="output" class="hidden"></div>
    </div>
</div>

<script type="module">
    import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";
    import { marked } from "https://esm.run/marked";

    // AYARLAR
    const _p1 = "AIzaSyBLd-KNzpSq";
    const _p2 = "UwiBibbL89-6V8-ilOFkUoc";
    const _sistem_giris_kodu = "aHpzYXVuYXN1bHRhbg=="; 

    // SABÄ°T METÄ°NLER
    const SABIT_BASLANGIC = "Destur Efendim, fakir aradÄ±ÄŸÄ±nÄ±z ilahiyi gÃ¼nÃ¼mÃ¼z TÃ¼rkÃ§esiyle harmanlayÄ±p arz ettim. DeÄŸiÅŸen kelimeleri renkli belirttim.";
    const SABIT_BITIS = "Allah Eyvallah SultanÄ±m. Huuu huu.";

    window.sifreKontrol = function() {
        const girilen = document.getElementById("passwordInput").value;
        const errorMsg = document.getElementById("errorMsg");
        const loginSec = document.getElementById("loginSection");
        const appSec = document.getElementById("appSection");

        if (btoa(girilen) === _sistem_giris_kodu) {
            loginSec.classList.add("hidden"); 
            appSec.classList.remove("hidden"); 
        } else {
            errorMsg.style.display = "block";
            document.getElementById("passwordInput").style.borderColor = "#c62828";
            document.getElementById("passwordInput").value = ""; 
        }
    }

    window.enterBasincaGiris = function(event) {
        if (event.key === "Enter") { window.sifreKontrol(); }
    }

    document.getElementById('fileInput').addEventListener('change', function(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.getElementById('preview');
                img.src = e.target.result;
                img.classList.remove("hidden");
            }
            reader.readAsDataURL(file);
        }
    });

    window.cevir = async function() {
        const fileInput = document.getElementById('fileInput');
        const status = document.getElementById('status');
        const output = document.getElementById('output');
        const btn = document.getElementById('translateBtn');

        if (fileInput.files.length === 0) { alert("LÃ¼tfen Ã¶nce bir fotoÄŸraf seÃ§in!"); return; }

        status.classList.remove("hidden");
        output.classList.add("hidden");
        output.innerHTML = "";
        btn.disabled = true;
        btn.innerText = "TercÃ¼me Ediliyor...";

        try {
            const _final_token = _p1 + _p2;
            const genAI = new GoogleGenerativeAI(_final_token);
            const model = genAI.getGenerativeModel({ model: "gemini-flash-latest" });

            const file = fileInput.files[0];
            const base64Data = await fileToGenerativePart(file);

            const prompt = `
                Sen edep sahibi bir derviÅŸsin. GÃ¶revin gÃ¶rseldeki ÅŸiiri okumak ve gÃ¼nÃ¼mÃ¼z insanÄ±nÄ±n anlamasÄ± iÃ§in uyarlamaktÄ±r.
                
                Ã–NEMLÄ° KURALLAR:
                1. GiriÅŸ/BitiÅŸ cÃ¼mlesi YAZMA.
                2. Åiiri DÃ–RTLÃœK (KITA) formatÄ±nda, alt alta mÄ±sralar halinde yaz.
                
                YAPILACAK Ä°ÅLEM (Ã‡OK Ã–NEMLÄ°):
                - Åiirin iÃ§indeki eski/OsmanlÄ±ca kelimeleri tespit et.
                - O kelimeyi sil ve yerine gÃ¼nÃ¼mÃ¼z TÃ¼rkÃ§esindeki en uygun karÅŸÄ±lÄ±ÄŸÄ±nÄ± yaz.
                - **DÄ°KKAT:** DeÄŸiÅŸtirip yerine koyduÄŸun yeni kelimeyi mutlaka **iki yÄ±ldÄ±z** iÃ§ine alarak kalÄ±n yap. (Ã–rnek: "Åal-i fena" yerine **Yokluk Ã¶rtÃ¼sÃ¼** yaz).
                - CÃ¼mlenin geri kalanÄ± (anlaÅŸÄ±lÄ±r kÄ±sÄ±mlar) aynen kalsÄ±n.
                
                Ã‡Ä±ktÄ± FormatÄ±:

                ### ğŸ“œ GÃ¼nÃ¼mÃ¼z TÃ¼rkÃ§esiyle HarmanlanmÄ±ÅŸ Hali
                (Buraya ÅŸiiri yaz. Eski kelimeleri Ã§Ä±kar, yerlerine **yeni karÅŸÄ±lÄ±klarÄ±nÄ±** koy. DeÄŸiÅŸen kelimeler koyu olsun.)

                ### ğŸ“– LÃ¼gatÃ§e
                (DeÄŸiÅŸtirdiÄŸin kelimeleri tablo olarak ver: | Eski Hali | Yeni Hali |)
            `;

            const result = await model.generateContent([prompt, base64Data]);
            const response = await result.response;
            const text = response.text(); 

            // Markdown iÅŸlemleri (SatÄ±r sonlarÄ±nÄ± koru)
            const parsedText = marked.parse(text, { breaks: true });

            const finalHTML = `
                <span class="dervis-sozu">${SABIT_BASLANGIC}</span>
                ${parsedText}
                <span class="dervis-bitis">${SABIT_BITIS}</span>
            `;

            output.innerHTML = finalHTML;
            output.classList.remove("hidden");

        } catch (error) {
            console.error(error);
            let hataMesaji = "Bir hata oluÅŸtu: " + error.message;
            if (error.message.includes("429")) {
                hataMesaji = "Hata: Kota doldu. LÃ¼tfen biraz bekleyip tekrar deneyin.";
            }
            output.innerHTML = `<span style="color:red;">${hataMesaji}</span>`;
            output.classList.remove("hidden");
        } finally {
            status.classList.add("hidden");
            btn.disabled = false;
            btn.innerText = "âœ¨ TercÃ¼meyi BaÅŸlat";
        }
    }

    async function fileToGenerativePart(file) {
        return new Promise((resolve) => {
            const reader = new FileReader();
            reader.onloadend = () => resolve({
                inlineData: { data: reader.result.split(',')[1], mimeType: file.type },
            });
            reader.readAsDataURL(file);
        });
    }
</script>

</body>
</html>